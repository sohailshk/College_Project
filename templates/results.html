<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Personalized Education Material</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Print styles -->
    <style>
        @media print {
            .no-print { display: none !important; }
            .card { border: 1px solid #ddd !important; box-shadow: none !important; }
            body { font-size: 12pt; }
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Header Section -->
        <div class="row no-print">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="text-primary">
                        <i class="fas fa-file-medical me-2"></i>
                        Your Personalized Education Material
                    </h1>
                    <div>
                        <button class="btn btn-outline-primary me-2" onclick="window.print()">
                            <i class="fas fa-print me-1"></i>Print
                        </button>
                        <a href="{{ url_for('download_results') }}" class="btn btn-outline-success me-2">
                            <i class="fas fa-download me-1"></i>Download
                        </a>
                        <a href="{{ url_for('index') }}" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>Generate New
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Education Material Content -->
        {% if education_material %}
        <div class="row">
            <div class="col-12">
                <!-- Title Section -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h2 class="card-title mb-0">
                            {{ education_material.title or 'Patient Education Material' }}
                        </h2>
                        {% if education_type %}
                        <small class="text-light">
                            Type: {{ education_type.replace('_', ' ').title() }}
                        </small>
                        {% endif %}
                    </div>
                    
                    {% if education_material.overview %}
                    <div class="card-body">
                        <h5 class="text-primary">Overview</h5>
                        <p class="lead">{{ education_material.overview }}</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Instructions Section -->
                {% if education_material.instructions %}
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-list-ol me-2"></i>
                            Step-by-Step Instructions
                        </h4>
                    </div>
                    <div class="card-body">
                        <ol class="list-group list-group-numbered">
                            {% for instruction in education_material.instructions %}
                            <li class="list-group-item">{{ instruction }}</li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
                {% endif %}

                <!-- Important Notes Section -->
                {% if education_material.important_notes %}
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            Important Notes to Remember
                        </h4>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% for note in education_material.important_notes %}
                            <li class="list-group-item">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                {{ note }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                <!-- Warning Signs Section -->
                {% if education_material.warning_signs %}
                <div class="card mb-4 border-warning">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Warning Signs - Watch For These
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning" role="alert">
                            <strong>Contact your healthcare provider immediately if you experience any of these symptoms:</strong>
                        </div>
                        <ul class="list-group list-group-flush">
                            {% for warning in education_material.warning_signs %}
                            <li class="list-group-item text-warning">
                                <i class="fas fa-triangle-exclamation me-2"></i>
                                {{ warning }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                <!-- When to Call Doctor Section -->
                {% if education_material.when_to_call_doctor %}
                <div class="card mb-4 border-danger">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-phone-medical me-2"></i>
                            When to Call Your Doctor
                        </h4>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% for call_reason in education_material.when_to_call_doctor %}
                            <li class="list-group-item">
                                <i class="fas fa-phone text-danger me-2"></i>
                                {{ call_reason }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                <!-- Additional Resources Section -->
                {% if education_material.additional_resources %}
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-book-medical me-2"></i>
                            Additional Resources & Tips
                        </h4>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% for resource in education_material.additional_resources %}
                            <li class="list-group-item">
                                <i class="fas fa-lightbulb text-warning me-2"></i>
                                {{ resource }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                <!-- Metadata Section (for development/debugging) -->
                {% if education_material.metadata %}
                <div class="card mb-4 no-print">
                    <div class="card-header bg-light text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            Generation Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Generated by:</strong> {{ education_material.metadata.generated_by }}</p>
                                {% if education_material.metadata.model %}
                                <p><strong>AI Model:</strong> {{ education_material.metadata.model }}</p>
                                {% endif %}
                                {% if generation_time %}
                                <p><strong>Generated at:</strong> {{ generation_time }}</p>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                {% if filename %}
                                <p><strong>Source File:</strong> {{ filename }}</p>
                                {% endif %}
                                {% if patient_info %}
                                <p><strong>Medical Conditions Found:</strong> {{ patient_info.conditions|length if patient_info.conditions else 0 }}</p>
                                <p><strong>Medications Found:</strong> {{ patient_info.medications|length if patient_info.medications else 0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Disclaimer -->
                <div class="alert alert-info" role="alert">
                    <h6 class="alert-heading">
                        <i class="fas fa-info-circle me-2"></i>
                        Important Disclaimer
                    </h6>
                    <p class="mb-0">
                        This educational material is generated based on your medical records and general medical guidelines. 
                        It is not a substitute for professional medical advice, diagnosis, or treatment. 
                        Always consult with your healthcare provider for personalized medical guidance.
                    </p>
                </div>
            </div>
        </div>
        {% else %}
        <!-- No Education Material Available -->
        <div class="row">
            <div class="col-12 text-center">
                <div class="alert alert-warning" role="alert">
                    <h4 class="alert-heading">No Education Material Available</h4>
                    <p>We couldn't find any education material to display. Please try uploading your medical records again.</p>
                    <hr>
                    <a href="{{ url_for('index') }}" class="btn btn-primary">
                        <i class="fas fa-upload me-2"></i>
                        Upload Medical Records
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
    
    <!-- Custom JavaScript for results page -->
    <script>
        // Auto-scroll to top when page loads
        window.onload = function() {
            window.scrollTo(0, 0);
        };
        
        // Enhanced print functionality
        function printEducationMaterial() {
            window.print();
        }
        
        // Download functionality
        function downloadAsText() {
            const content = document.querySelector('.container').innerText;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'patient_education_material.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
